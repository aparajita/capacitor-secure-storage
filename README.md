# capacitor-secure-storage

This plugin for [Capacitor 4+](https://capacitorjs.com) provides secure key/value storage on iOS and Android. It was originally designed to be a companion to [@aparajita/capacitor-biometric-auth](https://github.com/aparajita/capacitor-biometric-auth/#readme) in order to securely store login credentials, but can be used to store any JSON data types.

NOTE: For Capacitor 4 use version `3.x` of the plugin.

## BREAKING CHANGES: Upgrading from 2.x

To be consistent with JavaScriptâ€™s `Storage` and `@capacitor/preferences`, the plugin now returns `null` instead of throwing an exception when getting a non-existent item.

Also, the plugin no longer encrypts data on the web, since this plugin is designed for native storage, and including blowfish was unnecessary bloat.

## Installation

```sh
pnpm add @aparajita/capacitor-secure-storage # npm install, yarn add
```

Not using [pnpm](https://pnpm.js.org/)? You owe it to yourself to give it a try. Itâ€™s faster, better with monorepos, and uses _way, way_ less disk space than the alternatives.

## Usage

The API is thoroughly documented [here](src/definitions.ts). For a complete example of how to use this plugin in practice, see the [demo app](https://github.com/aparajita/capacitor-secure-storage-demo).

### iOS

On iOS, data is stored in the encrypted system keychain and is specific to your app. Please note that currently iOS will **not** delete an appâ€™s keychain data when the app is deleted. But since only an app with the same app id â€” which is guaranteed by Apple to be unique across all apps â€” can access that data, this is not a security issue.

[Capacitor 5 requires a minimum deployment platform version of iOS 13, which is usually automatically set within your Podfile](https://capacitorjs.com/docs/updating/5-0#ios).

#### iCloud Keychain sync

You may synchronize data with iCloud Keychain. Synchronization can be controlled globally and per operation. This allows you to share secure data (such as login credentials) for the same app across multiple devices.

> ðŸ‘‰ The user must enable iCloud Keychain on a device in order for data to sync.

To turn sync on or off globally, call `setSynchronize()`. You can override the global setting per operation by passing a boolean in the `sync` option.

Note that iOS considers the local keychain and iCloud keychain as two separate keychains. Which keychain is affected by an operation depends on the global and per operation sync setting. This means, for example, that a value can be stored and retrieved with the same key in both keychains.

> ðŸ‘‰ When the resolved sync setting is true, calls to `keys()` return the keys for **both** the iCloud and local keychains. Thus there may be duplicates.

### Android

On Android, data is encrypted using AES in GCM mode with a secret key generated by the Android KeyStore, then stored in SharedPreferences, which is specific to your app. If the app is deleted, its data is deleted as well.

[Capacitor 5 requires compile and target SDK version to be set to 33](https://capacitorjs.com/docs/updating/5-0#android).

### Web

On the web, data is stored unencrypted in `localStorage`, so that you can see the data you are storing. This is for debugging purposes only; you should not use this plugin on the web in production.
